var mapboxsearchcore=(()=>{var F=Object.defineProperty,be=Object.defineProperties,Se=Object.getOwnPropertyDescriptor,Re=Object.getOwnPropertyDescriptors,ke=Object.getOwnPropertyNames,_=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var Z=(n,e,t)=>e in n?F(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,g=(n,e)=>{for(var t in e||(e={}))B.call(e,t)&&Z(n,t,e[t]);if(_)for(var t of _(e))ee.call(e,t)&&Z(n,t,e[t]);return n},b=(n,e)=>be(n,Re(e)),ye=n=>F(n,"__esModule",{value:!0});var T=(n,e)=>{var t={};for(var o in n)B.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&_)for(var o of _(n))e.indexOf(o)<0&&ee.call(n,o)&&(t[o]=n[o]);return t};var ve=(n,e)=>{for(var t in e)F(n,t,{get:e[t],enumerable:!0})},Te=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ke(e))!B.call(n,s)&&(t||s!=="default")&&F(n,s,{get:()=>e[s],enumerable:!(o=Se(e,s))||o.enumerable});return n};var Ee=(n=>(e,t)=>n&&n.get(e)||(t=Te(ye({}),e,1),n&&n.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var G=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var L=(n,e,t)=>(G(n,e,"read from private field"),t?t.call(n):e.get(n)),h=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},E=(n,e,t,o)=>(G(n,e,"write to private field"),o?o.call(n,t):e.set(n,t),t);var y=(n,e,t)=>(G(n,e,"access private method"),t);var p=(n,e,t)=>new Promise((o,s)=>{var r=a=>{try{i(t.next(a))}catch(l){s(l)}},u=a=>{try{i(t.throw(a))}catch(l){s(l)}},i=a=>a.done?o(a.value):Promise.resolve(a.value).then(r,u);i((t=t.apply(n,e)).next())});var Ne={};ve(Ne,{Evented:()=>O,LngLat:()=>c,LngLatBounds:()=>f,MapboxAutofill:()=>I,MapboxError:()=>U,MapboxSearch:()=>$,MapboxValidate:()=>D,MatchCodeConfidence:()=>Q,SearchSession:()=>z,SessionToken:()=>m,debounce:()=>C,featureToSuggestion:()=>Le,polyfillFetch:()=>le});var x="https://api.mapbox.com/search/v1",W="suggest",K="retrieve",te="forward",ne="reverse",oe=`${x}/${W}`,se=`${x}/${K}`,re=`${x}/${te}`,ie=`${x}/permanent/${te}`,ae=`${x}/${ne}`,ge=`${x}/permanent/${ne}`;var c=class{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90");if(this.lng>180||this.lng<-180)throw new Error("Invalid LngLat longitude value: must be between -180 and 180")}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}static convert(e){if(e instanceof c)return new c(e.lng,e.lat);if(Array.isArray(e)&&e.length===2)return new c(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null&&("lng"in e||"lon"in e)&&"lat"in e)return new c(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}};var f=class{constructor(e,t){this._sw=c.convert(e),this._ne=c.convert(t)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c(this.getWest(),this.getNorth())}getSouthEast(){return new c(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toFlatArray(){return[this._sw.lng,this._sw.lat,this._ne.lng,this._ne.lat]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}static convert(e){if(!e)throw new Error("Invalid LngLatBounds convert value: falsy");if(e instanceof f)return new f(e.getSouthWest(),e.getNorthEast());if(Array.isArray(e)&&e.length===2)return new f(c.convert(e[0]),c.convert(e[1]));if(Array.isArray(e)&&e.length===4)return new f(c.convert([e[0],e[1]]),c.convert([e[2],e[3]]));throw new Error("`LngLatBoundsLike` argument must be specified as an array [<LngLatLike>, <LngLatLike>] or an array [<west>, <south>, <east>, <north>]")}};function ue(){let e=(Date.now().toString(16)+Math.random().toString(16)+Math.random().toString(16)).replace(/\./g,"");return[e.slice(0,8),e.slice(8,12),"4"+e.slice(12,15)+"-8"+e.slice(15,18),e.slice(18,30)].join("-")}var m=class{constructor(e){this.id=e!=null?e:ue()}toString(){return this.id}static convert(e){return new m(e instanceof m?e.id:e.toString())}};var xe="Unknown error",U=class extends Error{constructor(e,t){super(String(e.message||e.error||xe));this.name="MapboxError",this.statusCode=t}toString(){return`${this.name} (${this.statusCode}): ${this.message}`}};function S(n){return p(this,null,function*(){if(!n.ok){let e=yield n.json();throw new U(e,n.status)}})}var N=globalThis.fetch,ce=globalThis.AbortController;function le({fetch:n,AbortController:e},t=!1){if(!n)throw new Error("Fetch implementation must include implementations of `fetch`.");N&&!t||(N=n,ce=e)}function d(){if(!N)throw new Error("Fetch implementation not found. Please include a fetch polyfill in your application or use `polyfillFetch` from `@mapbox/search-js-core` to fix this issue.");return{fetch:N,AbortController:ce}}function R(...n){let e=[];for(let t of n){if(!t)continue;let o=Object.entries(t);for(let[s,r]of o)r!=null&&e.push(`${s}=${encodeURIComponent(String(r))}`)}return e.join("&")}var A,me,j,we,M=class{constructor(e={}){h(this,A);h(this,j);let s=e,{accessToken:t}=s,o=T(s,["accessToken"]);this.accessToken=t,this.defaults=g(g({},M.defaults),o)}suggest(e,t){return p(this,null,function*(){if(!e)throw new Error("searchText is required");let{sessionToken:o,signal:s}=t,r=b(g(g({},this.defaults),t),{sessionToken:o});if(r.eta_type&&(!r.origin||!r.navigation_profile))throw new Error("to provide eta estimate: eta, navigation_profile, and origin are required");if(r.origin&&!r.navigation_profile)throw new Error("to provide distance estimate: both navigation_profile and origin are required");let u=new URL(`${oe}/${encodeURIComponent(e)}`);u.search=y(this,A,me).call(this,r);let{fetch:i}=d(),a=yield i(u.toString(),{signal:s});return yield S(a),yield a.json()})}retrieve(e,t){return p(this,null,function*(){if(!e)throw new Error("suggestion is required");if(!this.canRetrieve(e))throw new Error("suggestion cannot be retrieved");let{sessionToken:o,signal:s}=t,r=m.convert(o),u=new URL(se);u.search=R({access_token:this.accessToken,session_token:r.id});let{fetch:i}=d(),a=yield i(u.toString(),b(g({},y(this,j,we).call(this,e)),{signal:s}));return yield S(a),yield a.json()})}canRetrieve(e){let t=e.action;return t?t.method==="POST"&&t.endpoint===K:!1}canSuggest(e){let t=e.action;return t?t.method==="POST"&&t.endpoint===W:!1}forward(o){return p(this,arguments,function*(e,t={}){if(!e)throw new Error("searchText is required");let s=g(g({},this.defaults),t),r=s.permanent?ie:re,u=new URL(`${r}/${encodeURIComponent(e)}`);u.search=y(this,A,me).call(this,s);let{fetch:i}=d(),a=yield i(u.toString(),{signal:s.signal});return yield S(a),yield a.json()})}reverse(o){return p(this,arguments,function*(e,t={}){if(!e)throw new Error("lngLat is required");let s=g(g({},this.defaults),t),r=typeof e=="string"?e:c.convert(e).toArray().join(","),u=s.permanent?ge:ae,i=new URL(`${u}/${encodeURIComponent(r)}`);i.search=R({access_token:this.accessToken,language:s.language,limit:s.limit},s.types&&{types:typeof s.types=="string"?s.types:[...s.types].join(",")});let{fetch:a}=d(),l=yield a(i.toString(),{signal:s.signal});return yield S(l),yield l.json()})}},$=M;A=new WeakSet,me=function(e){return R({access_token:this.accessToken,language:e.language,country:e.country,limit:e.limit,navigation_profile:e.navigation_profile,eta_type:e.eta_type},e.sessionToken&&{session_token:m.convert(e.sessionToken).id},e.origin&&{origin:typeof e.origin=="string"?e.origin:c.convert(e.origin).toArray().join(",")},e.proximity&&{proximity:typeof e.proximity=="string"?e.proximity:c.convert(e.proximity).toArray().join(",")},e.bbox&&{bbox:typeof e.bbox=="string"?e.bbox:f.convert(e.bbox).toFlatArray().join(",")},e.types&&{types:typeof e.types=="string"?e.types:[...e.types].join(",")})},j=new WeakSet,we=function(e){if(!this.canRetrieve(e)&&!this.canSuggest(e))throw new Error("Suggestion cannot be retrieved or suggested");let t=e.action,o=JSON.stringify(t.body);return{method:t.method,body:o,headers:{"Content-Type":"application/json","Content-Length":o.length.toString()}}},$.defaults={language:"en"};var pe="https://api.mapbox.com/autofill/v1",Ae="suggest",Oe="retrieve",fe=`${pe}/${Ae}`,he=`${pe}/${Oe}`;var V,Pe,H=class{constructor(e={}){h(this,V);let s=e,{accessToken:t}=s,o=T(s,["accessToken"]);this.accessToken=t,this.defaults=g(g({},H.defaults),o)}suggest(e,t){return p(this,null,function*(){if(!e)throw new Error("searchText is required");let{sessionToken:o,signal:s}=t,r=b(g(g({},this.defaults),t),{sessionToken:o}),u=new URL(`${fe}/${encodeURIComponent(e)}`);u.search=y(this,V,Pe).call(this,r);let{fetch:i}=d(),a=yield i(u.toString(),{signal:s});yield S(a);let l=yield a.json();return b(g({},l),{suggestions:l.suggestions.map(Y=>b(g({},Y),{original_search_text:e}))})})}retrieve(e,t){return p(this,null,function*(){if(!e)throw new Error("suggestion is required");if(!this.canRetrieve(e))throw new Error("suggestion cannot be retrieved");let{sessionToken:o,signal:s}=t,r=m.convert(o),u=new URL(`${he}/${e.action.id}`);u.search=R({access_token:this.accessToken,session_token:r.id});let{fetch:i}=d(),a=yield i(u.toString(),{signal:s});return yield S(a),yield a.json()})}canRetrieve(e){let t=e.action;return typeof(t==null?void 0:t.id)=="string"}},I=H;V=new WeakSet,Pe=function(e){return R({access_token:this.accessToken,language:e.language,country:e.country,limit:e.limit},e.sessionToken&&{session_token:m.convert(e.sessionToken).id},e.proximity&&{proximity:typeof e.proximity=="string"?e.proximity:c.convert(e.proximity).toArray().join(",")},e.bbox&&{bbox:typeof e.bbox=="string"?e.bbox:f.convert(e.bbox).toFlatArray().join(",")})},I.defaults={language:"en",proximity:"ip"};var Q=(s=>(s.exact="exact",s.high="high",s.medium="medium",s.low="low",s))(Q||{});var w,O=class{constructor(){h(this,w,{})}addEventListener(e,t){let o=L(this,w);o[e]||(o[e]=[]),o[e].push(t)}removeEventListener(e,t){let o=L(this,w);if(!o[e])return;let s=o[e],r=s.indexOf(t);r!==-1&&s.splice(r,1)}fire(e,t){let o=L(this,w);if(!o[e])return;let s=o[e];for(let r of s)r(t)}};w=new WeakMap;function C(n,e,t){let o=null;return(...s)=>{o!==null&&clearTimeout(o);let r=t&&t();o=setTimeout(()=>{o=null,!(r==null?void 0:r.aborted)&&n(...s)},e)}}function J(){let{AbortController:n}=d();return new n}var v,k,P,z=class extends O{constructor(e,t=0){super();this.sessionToken=new m;h(this,v,void 0);h(this,k,J());h(this,P,void 0);E(this,P,C((r,...u)=>p(this,[r,...u],function*(o,s={}){if(L(this,k).abort(),E(this,k,J()),!o){E(this,v,null),this.fire("suggest",L(this,v));return}try{let i=yield this.search.suggest(o,b(g({sessionToken:this.sessionToken},s),{signal:L(this,k).signal}));E(this,v,i),this.fire("suggest",i)}catch(i){if(i.name==="AbortError")return;this.fire("suggesterror",i)}}),t,()=>L(this,k).signal)),Object.defineProperties(this,{search:{value:e,writable:!1},debounce:{value:t,writable:!1}})}get suggestions(){return L(this,v)}suggest(e,t){return L(this,P).call(this,e,t),new Promise((o,s)=>{let r,u;r=i=>{this.removeEventListener("suggest",r),this.removeEventListener("suggesterror",u),o(i)},u=i=>{this.removeEventListener("suggest",r),this.removeEventListener("suggesterror",u),s(i)},this.addEventListener("suggest",r),this.addEventListener("suggesterror",u)})}clear(){this.suggest("")}retrieve(e,t){return p(this,null,function*(){let o=yield this.search.retrieve(e,g({sessionToken:this.sessionToken},t));return this.fire("retrieve",o),o})}canRetrieve(e){return this.search.canRetrieve?this.search.canRetrieve(e):!0}canSuggest(e){return this.search.canSuggest?this.search.canSuggest(e):!0}abort(){L(this,k).abort(),E(this,k,J())}};v=new WeakMap,k=new WeakMap,P=new WeakMap;function Le(n){let{properties:e}=n;return g({},e)}var _e="https://api.mapbox.com/autofill/v1",Fe="retrieve",de=`${_e}/${Fe}`;var q,Ue,X=class{constructor(e={}){h(this,q);let s=e,{accessToken:t}=s,o=T(s,["accessToken"]);this.accessToken=t,this.defaults=g(g({},X.defaults),o)}validate(e,t){return p(this,null,function*(){if(!e)throw new Error("searchText is required");let{sessionToken:o,signal:s}=t,r=b(g(g({},this.defaults),t),{sessionToken:o}),u=new URL(`${de}/${encodeURIComponent(e)}`);u.search=y(this,q,Ue).call(this,r);let{fetch:i}=d(),a=yield i(u.toString(),{signal:s});yield S(a);let l=yield a.json();return l.features.length>0&&(l.features=[l.features[0]]),l})}},D=X;q=new WeakSet,Ue=function(e){return R({access_token:this.accessToken,language:e.language,country:e.country},e.sessionToken&&{session_token:m.convert(e.sessionToken).id},e.proximity&&{proximity:typeof e.proximity=="string"?e.proximity:c.convert(e.proximity).toArray().join(",")},e.bbox&&{bbox:typeof e.bbox=="string"?e.bbox:f.convert(e.bbox).toFlatArray().join(",")})},D.defaults={language:"en",proximity:"ip"};return Ee(Ne);})();
//# sourceMappingURL=mapboxsearchcore.js.map
